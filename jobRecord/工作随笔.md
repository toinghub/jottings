## 开发注意

# vue2+Ts

```js
@Watch('message',{
    immediate:true,    
    // immediate表示在watch中首次绑定的时候，是否执行handler，
    // 值为true则表示在watch中声明的时候，就立即执行handler方法，
    // 值为false，则和一般使用watch一样，在数据发生变化的时候才执行handler。
})
```

>  不确定类型 , 应该使用unknown 
>
> 当属性可选时，应该用类继承的方式去书写



# CSS随笔

```css
position: sticky; //粘性布局	
background: linear-gradient(180deg, #f2f2f2, #ffffff);  //背景渐变
width:calc(100% - 100px)  //单位换算计算
visibility:hidden; 隐藏元素（位置保留）
:src="require('./1.jpg')" uniapp 使用本地路径加require
background: url("~@/assets/xxx.jpg" //~符号作为前缀的路径视作依赖模块而去解析
border-bottom: 50px solid transparent;   //transparent 透明
user-select   //用户选择文本 node:禁止 all:选中所有
filter: grayscale(.95); //让网站变灰
word-break: break-all;  //英文强制换行
```

#### 伪类 | 伪元素

```css
:empty   //当节点为空时，执行此样式
:focus-within //元素获得焦点，或该元素的后代元素获得焦点，就会匹配
::placeholder //修改placeholder的样式
::selection //自定义选中样式 有限制样式
```

#### 鼠标事件穿透当前层

```css
pointer-events:none //鼠标事件穿透当前层 | 禁止鼠标事件
pointer-events:auto //鼠标不会穿透当前层
```

#### 苹果底部边距

```css
padding-bottom: constant(safe-area-inset-bottom);
padding-bottom: env(safe-area-inset-bottom);
```

#### 字体渐变色

```css
background-image: linear-gradient(right, #7a492f, #cb7e3c); // 为元素提供渐变色背景
background-clip: text;  // 用文本剪辑背景
-webkit-text-fill-color: transparent;  //使用透明颜色填充文本  
```

#### 撑满子元素高度

```css
overflow: hidden ;  //父元素  
margin-bottom:-200px;padding--bottom:200px //子元素
```

#### 文本溢出

```css
//单行
overflow: hidden;            // 溢出隐藏
text-overflow: ellipsis;      // 溢出用省略号显示
white-space: nowrap;          // 规定段落中的文本不进行换行

//多行
overflow: hidden;             // 溢出隐藏
text-overflow: ellipsis;      // 溢出用省略号显示
display: -webkit-box;          // 作为弹性伸缩盒子模型显示。
-webkit-box-orient: vertical;  // 设置伸缩盒子的子元素排列方式：从上到下垂直排列
-webkit-line-clamp: 2;         // 显示的行数
```

#### css变量

```css
:root{   //web是:root   小程序是page
    --size:100  
}
div{ //var 读取  calc 计算
    width:calc(var(--size)*2px)
}

@padding-md:15px
padding:@padding-md
```

#### css 类绑定

```html
<template>
  <!-- 0. 普通写法 -->
  <div :class="color"></div>
  <!-- 1. 对象语法 -->
  <div :class="{ red: isRed }"></div>
  <!-- 2. 数组语法  解析这两个变量 添加class -->
  <div :class="[classA, classB]"></div>
  <!-- 3. 综合写法 -->
  <div :class="[classA, { classB: isB, classC: isC }]"></div>
  <!-- 4. 三元运算 -->
  <div :class="isRed ? 'red' : ''"></div>
</template>
```

#### 让每个元素之间隔开px

```css
display: flex | grid；
gap: 20px;
```

#### 动画

```css
.img_rotate {
	animation: changeright 50s linear infinite;
}

@keyframes changeright {
	0% {
		-webkit-transform: rotate(0deg);
	}

	50% {
		-webkit-transform: rotate(180deg);
	}

	100% {
		-webkit-transform: rotate(360deg);
	}
}
```







css特性

>在flex子元素中设置不同方向的，子元素就可偏移
>
>当在定位中同时设置lert和right时，就隐式的设置的宽度
>



# JavaScript随笔

```javascript
location.reload(); //刷新页面
window.location   //获取网址信息
Object.values(a) // 枚举a对象所有的属性值
arr.flat(Infinity) // 扁平化数组,Infinity默认深度最深，也可指定深度
[a,b] = [b,a]  //使用解构，快速交互ab值
window.location.href=url    //(动态输出跳转)  跳转链接
click.once   //方法只执行一次
array.at(-1 ) //数组负索引（-1为最后一位）微信内部不支持此语法
let b =  a !== 0 ? ( a ? a: "-") : 0 //括号可省略
@Watch("$route", { immediate: true }) //监听route可以获取页面显示
&nbsp; //空格
navigator.userAgent.toLowerCase() //返回当前用户所使用的是什么浏览器
try {} catch (error) {} finally {} //错误反馈
Navigator //浏览器的相关信息的对象
const data = { [key]:value } //属性名变量传入
```

监听手机返回

```js
  created() {
    if (window.history && window.history.pushState) {
      history.pushState(null, "", document.URL);
      window.addEventListener("popstate", this.goBack, false);
    }
    this.init();
  }

  destroyed() {
    window.removeEventListener("popstate", this.goBack, false);
  }
  goBack() {
    (<any>this).$router.go(this.backspace);
  }
```



#### app返回退出软件问题

```js
 document.addEventListener('plusready', function () {
      var webview = plus.webview.currentWebview();
      plus.key.addEventListener('backbutton', function () {
        webview.canBack(function (e) {
          if (e.canBack) {
            webview.back();
          } else {
            //webview.close(); //hide,quit
            //plus.runtime.quit();
            //首页返回键处理
            //处理逻辑：1秒内，连续两次按返回键，则退出应用；
            var first = null;
            plus.key.addEventListener('backbutton', function () {
              //首次按键，提示‘再按一次退出应用’
              if (!first) {
                first = new Date().getTime();
                console.log('再按一次退出应用');
                setTimeout(function () {
                  first = null;
                }, 1000);
              } else {
                if (new Date().getTime() - first < 1500) {
                  plus.runtime.quit();
                }
              }
            }, false);
          }
        })
      });
    });
```





#### 单行代码

```js
//数组去重
const uniqueArr = (arr) => [...new Set(arr)];

//从url获取参数并转为对象
const getParameters = URL => JSON.parse(`{"${decodeURI(URL.split("?")[1]).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"')}"}`)

//检查对象是否为空
const isEmpty = obj => Reflect.ownKeys(obj).length === 0 && obj.constructor === Object;

//反转字符串
const reverse = str => str.split('').reverse().join('');

//生成随机十六进制颜色
const randomHexColor = () => `#${Math.floor(Math.random() * 0xffffff).toString(16).padEnd(6, "0")}`

//检查当前选项卡是否在后台
const isTabActive = () => !document.hidden; 

//两日期之间相差的天数
const dayDiff = (date1, date2) => Math.ceil(Math.abs(date1.getTime() - date2.getTime()) / 86400000);

//将 RGB 转换为十六进制
const rgbToHex = (r, g, b) =>   "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
```



#### 知识

```javascript
$attrs // 封装第三方库文件   使用attrs数据会及时响应
```

#### 扩展运算符

```js
let aobj = {a:1,b:2}
let bobj = {a:3,b:4,c:5}
aobj = {...aobj,...bobj} //{a:3,b:4,c:5}
```

#### 循环判断

```js
while (判断条件){ 执行代码 } //先判断，后执行;
do{ 执行代码 }while( 判断条件 ) //先执行，后判断
```

#### 操作符

```javascript
cat?.name //可选链操作符  可以读取cat深处的值，不用担心是否有效
a ?? b  //空值合并操作符 左侧为 null 或者 undefined 时，返回右侧数据
a ??= b //空值赋值运算符  左侧为 null 或者 undefined 时,右侧数据赋值给左侧
!.  //非空断言操作符  ts内容  
2**10  //幂运算  1024
1_000_000 // 使用数字分隔符  原意不变
a ||= b //或等于  a || (a = b)
a ||= b //与等于  a && (a = b)
```



#### 防抖动

```javascript
debounce (wait, fun,data) {
      if (this.timer) {
        clearInterval(this.timer)
      }
      this.timer = setTimeout(() => {
        fun(data)
      }, wait)
    },
```



#### 节流

```javascript
throttling (wait, fun) {
      let _this = this
      let now = +new Date()
      if (!this.last || (now - this.last) > wait) {
        _this.last = now
        fun()
      }
    },
```



截取视频指定帧图片( [上传并保存在阿里云服务器](https://help.aliyun.com/document_detail/64555.html?spm=a2c4g.11174283.6.1736.7a6a7da2WHCSlD) )

> ?x-oss-process=video/snapshot,t_0,f_jpg,w_0,h_0,m_fast,ar_auto
>
> > t：指定截图时间
> > w：指定截图宽度
> > h：指定截图高度
> > m：指定截图模式（默认模式，根据时间精确截图，fast则截取该时间点之前的最近的关键帧）
> > f：图片的格式
> > ar：是否根据视频信息自动旋转图片





#### 多字节替换

```javascript
let searchStr = this.search
      searchStr = searchStr.replace(new RegExp(" ", "gm"), "|");
      searchStr = searchStr.replace(new RegExp(",", "gm"), "|");
```



#### 查找数组最大最小值

```javascript
let data = [1,20,20,33,55,33,66,77]
let maxNum = Math.max(...data);
let minNum = Math.min(...data);
```



#### uniapp 刷新页面

```js
 // 获取当前页面栈实例
 const pages = getCurrentPages()
 // 获取当前页面
 const curPage = pages[pages.length - 1]
 // 声明一个当前页面
 curPage.onLoad(curPage.options) // 传入参数
```



### 浏览器关闭提醒

```javascript
 window.onbeforeunload = function (e) {
      e = e || window.event;
      // 兼容IE8和Firefox 4之前的版本
      if (e) {
        e.returnValue = '关闭提示';
      }
      // Chrome, Safari, Firefox 4+, Opera 12+ , IE 9+
      return '关闭提示';
    };
```



#### 存储监听

```js
  const setItem = localStorage.setItem
    localStorage.setItem = function (name, value) {
        setItem.apply(this, arguments) //更改setItem的this指向，arguments传入的参数数组（name,value）
        var event = new Event('setItem') //构造函数
        event.key = name
        event.value = value
        window.dispatchEvent(event); //发送事件到监听器上
    }
    // 页面使用
    window.addEventListener('setItem', function (e) {//注册监听setItem事件
        document.querySelector('.view').innerText = `${e.key}： ${e.value}`
    })
```





#### 时间格式   

```javascript
Vue.filter('formatDate1', function (value, fmt) {
  let getDate = new Date(value);
  let o = {
    'M+': getDate.getMonth() + 1, //月份
    'd+': getDate.getDate(),//日
    'h+': getDate.getHours(),//小时
    'm+': getDate.getMinutes(),//分钟
    's+': getDate.getSeconds(),//秒数
    'q+': Math.floor((getDate.getMonth() + 3) / 3),//季度
    'S': getDate.getMilliseconds()//毫秒
  };
  if (/(y+)/.test(fmt)) {
    fmt = fmt.replace(RegExp.$1, (getDate.getFullYear() + '').substr(4 - RegExp.$1.length))
  }
  for (let k in o) {
    if (new RegExp('(' + k + ')').test(fmt)) {
      fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? (o[k]) : (('00' + o[k]).substr(('' + o[k]).length)))
    }
  }
  return fmt;
})
```



#### 表格导出

```js
file-saver  //文件
XLSX //表格转json


 // 文件名
        let filename = `${this.title}.xlsx`;
        /* 或者用id */
        let wb = XLSX.utils.table_to_book(
            document.getElementById("tableExport")
        );
        console.log(els, wb);
        /* get binary string as output */
        let wbout = XLSX.write(wb, {
            bookType: "xlsx",
            bookSST: true,
            type: "array"
        });
        try {
            FileSaver.saveAs(
                new Blob([wbout], { type: "application/octet-stream" }),
                filename
            );
        } catch (e) {
            console.log(e);
        }
```



### [数组处理](https://www.runoob.com/w3cnote/es6-map-set.html)

```js
//并集
var a = new Set([1, 2, 3]);
var b = new Set([4, 3, 2]);
var union = new Set([...a, ...b]); // {1, 2, 3, 4}

//交集
var a = new Set([1, 2, 3]);
var b = new Set([4, 3, 2]);
var intersect = new Set([...a].filter(x => b.has(x))); // {2, 3}

//差集
var a = new Set([1, 2, 3]);
var b = new Set([4, 3, 2]);
var difference =new Set([...[...a].filter(x => !b.has(x)),...[...b].filter(x => !a.has(x))]); // {1,4}
```





# 功能技巧

## 工具

```js
vue-clipboard2 //剪切板
@chenfengyuan/vue-qrcode  //生成二维码 vue3 vue2可用
mobile-detect //获取手机设备信息
moment  //日期处理类库
vConsole //手机端测试打开控制台
vue-class-component && vue-property-decorator  //class风格开发组件 
image-conversion //图片压缩
qs库   //编码
```



## 命令

```js
 npm cache clear --force //清楚缓存
 pwd  //打开当前目录的绝对路径
```



##### 阻止用户截图

* 1.阻止右键保存和拖拽
* 2.失焦后加遮罩层
* 3.高速动态马赛克

## 注意

- 微信小程序单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。
- 直播组件：直播拉流(live-player) + 直播推流(live-pusher)
- uni.setNavigationBarTitle 更改头部标题
- webpack对于小于8k的图片，会将图片转成base64 直接插入图片 
- items.push(...newItems)  会有爆栈风险
- router-view加个唯一的key，来保证路由切换时都会重新渲染触发钩子