# [HTTP 协议](https://juejin.cn/post/6844903844216832007?searchId=20231017121823E10D0015FEA4D06151BC#heading-0)

-   定义 Web 客户端如何从 Web 服务器请求 Web 页面，以及服务器如何把 Web 页面传送给客户端
-   客户端向服务器发送请求报文，包含请求方法、URL、协议版本、请求头部和请求数据
-   服务器返回状态行作为响应，包括协议版本、成功或错误代码、服务器信息、响应头部和响应数据
-   HTTP 是不保存状态的协议，既无状态协议

## HTTP报文

###  **请求报文** 

* 请求行（请求方法、协议版本）
* 请求首部（请求URI、客户端信息等
* 内容实体（用户信息和资源信息等，可为空） 

![](../../images\请求报文.png)

### **响应报文** 

*  状态行（协议版本、状态码） 
*  响应首部（服务器名称、资源标识等） 
*  内容实体（服务端返回的资源信息） 

![](F:\桌面\随笔\images\响应报文.png)

## 请求方法

|   GET   |   get   |        用于获取服务器资源        |
| :-----: | :-----: | :------------------------------: |
|  POST   |  post   |         用于传输实体主体         |
|   PUT   |   put   |    用于更新某个较为完整的文件    |
|  PATCH  |  patch  |     用于文件的部分内容的更新     |
| DELETE  | delete  |           用于删除文件           |
|  HEAD   |  head   | 用于获取报文首部，不返回报文主体 |
| OPTIONS | options |  用于询问请求URI资源支持的方法   |

## 状态码

| 2XX  | 成功（这系列表明请求被正常处理了）                     |
| :--- | :----------------------------------------------------- |
| 200  | OK，表示从客户端发来的请求在服务器端被正确处理         |
| 204  | No content，表示请求成功，但响应报文不含实体的主体部分 |
| 206  | Partial Content，进行范围请求成功                      |

| 3XX  | 重定向（表明浏览器要执行特殊处理）                           |
| ---- | ------------------------------------------------------------ |
| 301  | moved permanently，永久性重定向，表示资源已被分配了新的 URL  |
| 302  | found，临时性重定向，表示资源临时被分配了新的 URL            |
| 303  | see other，表示资源存在着另一个 URL，应使用 GET 方法获取资源（对于301/302/303响应，几乎所有浏览器都会删除报文主体并自动用GET重新请求） |
| 304  | not modified，协商缓存，与重定向无关                         |
| 307  | temporary redirect，临时重定向，和302含义类似，但是期望客户端保持请求方法不变向新的地址发出请求 |

| 4XX  | 客户端错误                                                   |
| ---- | ------------------------------------------------------------ |
| 400  | bad request，请求报文存在语法错误                            |
| 401  | unauthorized，表示发送的请求需要有通过 HTTP 认证的认证信息   |
| 403  | forbidden，表示对请求资源的访问被服务器拒绝，可在实体主体部分返回原因描述 |
| 404  | not found，表示在服务器上没有找到请求的资源                  |

| 5XX  | 服务器错误                                                   |
| ---- | ------------------------------------------------------------ |
| 500  | internal sever error，表示服务器端在执行请求时发生了错误     |
| 501  | Not Implemented，表示服务器不支持当前请求所需要的某个功能    |
| 503  | service unavailable，表明服务器暂时处于超负载或正在停机维护，无法处理请求 |

## 首部字段

| 通用首部          | 作用（请求报文和响应报文都可能使用）                         |
| ----------------- | ------------------------------------------------------------ |
| Cache-Control     | 控制缓存的行为：`no-cache`（强制向服务器再次验证）、`no-store`（不做任何缓存）、`max-age=111111`（资源可缓存最大时间 秒）、`public`（客户端、代理服务器都可利用缓存）、`private`（代理服务器不可用缓存） |
| Connection        | 浏览器想要优先使用的连接类型： `keep-alive close`（开启和关闭持久连接） |
| Date              | 创建报文时间                                                 |
| Pragma            | 只用于请求报文，客户端要求中间服务器不返回缓存的资源         |
| Via               | 代理服务器相关信息，每经过一个代理服务器就会添加相关信息，用逗号分割 |
| Transfer-Encoding | 传输编码方式：`chunked`分块传输                              |
| Upgrade           | 要求客户端使用的升级协议，需配合`Connection: Upgrade`一起使用：`websocket` |
| Warning           | 缓存相关问题的警告                                           |

| 请求首部            | 作用（请求报文专用）                                         |
| ------------------- | ------------------------------------------------------------ |
| Accept              | 能正确接收的媒体类型：`application/json` `text/plain`        |
| Accept-Charset      | 能正确接收的字符集: `unicode-1-1`                            |
| Accept-Encoding     | 能正确接收的编码格式列表：`gzip deflate`                     |
| Accept-Language     | 能正确接收的语言列表：`zh-cn,zh;1=0.9,en,1=0.8`              |
| Authorization       | 客户端认证信息：`Bearer dSdSdFFlsfdjasd123`，一般存token用   |
| Cookie              | 发送给服务器的Cookie信息                                     |
| Expect              | 期待服务端的指定行为                                         |
| From                | 请求方邮箱地址                                               |
| Host                | 服务器的域名，用于区分单台服务器多个域名的虚拟主机，是HTTP/1.1唯一必须包含的字段。 |
| If-Match            | 两端资源标记比较，只有判断条件为真服务端才会接受请求：`If-Mach: "123456`，和服务端文件标记比较 |
| If-Modified-Since   | 本地资源未修改返回 304（比较时间）                           |
| If-None-Match       | 本地资源未修改返回 304（比较标记）                           |
| User-Agent          | 客户端信息                                                   |
| Max-Forwards        | 限制可被代理及网关转发的次数                                 |
| Proxy-Authorization | 向代理服务器发送验证信息                                     |
| Range               | 请求某个内容的一部分，配合`If-Range`使用                     |
| Referer             | 请求发起页面的原始URI                                        |
| TE                  | 传输编码方式                                                 |

| 响应首部           | 作用（响应报文专用）                                    |
| ------------------ | ------------------------------------------------------- |
| Accept-Ranges      | 告知客户端服务器是否可接受范围请求，是`bytes`，否`none` |
| Age                | 资源在代理缓存中存在的时间                              |
| ETag               | 资源标识，资源发生变化时标识也会发生改变                |
| Location           | 客户端重定向到某个 URL                                  |
| Proxy-Authenticate | 向代理服务器发送验证信息                                |
| Server             | 服务器名字：`Apache Nginx`                              |
| WWW-Authenticate   | 获取资源需要的认证方案                                  |
| Set-Cookie         | 需要存在客户端的信息，一般用于识别用户身份              |

| 实体首部         | 作用（补充请求报文或响应报文相关信息）                       |
| ---------------- | ------------------------------------------------------------ |
| Allow            | 资源的正确请求方式：`GET HEAD POST`                          |
| Content-Encoding | 内容的编码格式：`gzip deflate`                               |
| Content-Language | 内容使用的语言：`zh-CN`                                      |
| Content-Length   | request body 长度（即实体主体的大小）：                      |
| Content-Location | 返回数据的备用地址                                           |
| Content-MD5      | Base64加密格式的内容 MD5检验值                               |
| Content-Range    | 响应主体的内容范围                                           |
| Content-Type     | 内容的媒体类型（如'application/json;charset=UTF-8'则会发送预检请求） |
| Expires          | 内容的过期时间                                               |
| Last_modified    | 内容的最后修改时间                                           |

## [URI|URL|URN](https://blog.csdn.net/K_sheep/article/details/126964806)

### URI - 统一资源标识符

> URI是标识逻辑或物理资源的字符序列 
>
> 主要用于定义项目的标识 
>
>  URI不涉及协议规范 

#### 作用

*  通过使用位置，名称或两者来标识Internet上的资源 
*  允许统一识别资源 

#### 组成内容 

```css
ftp://admin:123@mysite.net:8888/share/movie/Black Gump.mkv
```

1.  资源的命名机制  - `ftp:`
2.  存放资源的主机名 - ` admin:123@mysite.net:8888`
3.  资源自身的名称 -  `share/movie/Black Gump.mkv`

### URL -   统一资源定位符 

> 主要用于链接网页 
>
>  需要指定要使用的协议类型 

#### 组成内容 

```css
http://www.baidu.com:888/page/index?id=1&name=daxia#article
```

1.  用于访问资源的协议 - `http:`
2.  服务器的位置（IP地址或域名），端口号（可选） - `www.baidu.com:888`
3.  资源在服务器目录结构中的位置 - `page/index`
4.  片段标识符（可选） - `?id=1&name=daxia#article`

### URN -  统一资源名称

> 通过名字来标识资源的 
>
>  它不包含任何协议 

* 作为特定内容的唯一名称使用的
*  如图书的编号（ISBN）urn:isbn:0234663 

### 区别

* **`URN` 和 `URL` 都是 `URI` 的子集**  

* ```css
  URL：指定位置的 URI
  URN：指定名称的 URI
  URI：同时指定名称和位置的 URI
  ```

## HTTP版本

### HTTP/1.0

*  使用在一些较为简单的网页上和网络请求上 

#### **串行连接**

*  HTTP/1.0 版本称为**串行连接**或**短连接**、**短轮询**
*  每次发起请求都**必须建立新的tcp连接** 
* 每次HTTP通信后都要**断开**TCP连接，所以每个新的HTTP请求都需要建立一个新的连接 

### HTTP/1.1

*  用于 -- **http://** 

*  引入了更多的缓存控制策略 
*  允许范围请求，即在请求头中加入`Range`头部 
*  请求消息和响应消息都必须包含`Host`头部 , 以区分同一个物理主机中的不同虚拟主机的域名 

#### **持久连接**

* HTTP/1.1 实现默认所有连接都是**持久连接**（ 也叫**长连接**、**长轮询** ）
*  一定时间内，同一域名下的HTTP请求，只要两端都没有提出断开连接，则持久保持TCP连接状态，其他请求可以复用这个连接通道。
* 容易造成**线头阻塞** ---  持久连接采用阻塞模式，下次请求必须等到上次响应返回后才能发起，如果上次的请求还没返回响应内容，下次请求就只能等着

####  **管道化持久连接** 

*  不用等待响应返回而发送下个请求并按顺序返回响应 
*  响应必须按顺序返回 
*  现代浏览器并未默认开启管道化 

### HTTP/2.0

*  用于 --   **https://** 

*  两个重要概念  --  帧（frame）和流（stream） 
*  帧 -- 数据传输的最小的单位 
*  流 -- 多个帧组成的数据流 , 每个流表示一个请求 
*  协议解析 -- 采用二进制格式 
*  使用encoder来减少需要传输的头部大小, 通讯双方各自cache一份头部 fields表 

####  **HTTP/2.0多路复用** 

* 每个HTTP请求都有一个序列标识符，这样浏览器可以并发多个请求
* 服务器接收到数据后，根据序列标识符重新排序成不同的请求报文，就不会导致数据错乱 
* 服务端也可以并发返回多个响应给浏览器，浏览器收到后根据序列标识重新排序并归入各自的请求的响应报文 
*  同一个域名下的所有请求都复用同一个TCP连接，极大增加了服务器处理并发的上限 
*  当连接中出现了**丢包**的情况，就会导致整个 TCP 都要开始等待重传，也就导致后面的所有数据都被阻塞了 

### HTTP/3.0

* 放弃使用TCP，而使用基于UIC退出的QUIC协议
*  **避免包阻塞**  --  不同的流之间的数据传输真正实现了相互独立互不干扰 
*  **快速重启会话**  --  QUIC协议使用特有的UUID来标记每一次连接，在网络环境发生变化的时候，只要UUID不变，就能不需要握手，继续传输数据 

## WEB安全防范

#### [XSS 攻击](https://blog.csdn.net/weixin_47450807/article/details/123207164)

#### [CSRF 攻击](https://blog.csdn.net/weixin_44211968/article/details/124703525)

#### [点击劫持](https://blog.csdn.net/qq_56327824/article/details/123808798)

#### [中间人攻击](https://baijiahao.baidu.com/s?id=1687472686266307627&wfr=spider&for=pc)

